<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Bernhard Meindl" />

<meta name="date" content="2020-08-12" />

<title>Usage of the sdcHierarchies-Package</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Usage of the sdcHierarchies-Package</h1>
<h4 class="author">Bernhard Meindl</h4>
<h4 class="date">2020-08-12</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <code>sdcHierarchies</code> packages allows to create, modify and export nested hierarchies that are used for example to define tables in statistical disclosure control software such as in <a href="https://cran.r-project.org/package=sdcTable"><strong>sdcTable</strong></a></p>
</div>
<div id="usage" class="section level1">
<h1>Usage</h1>
<p>Before using, the package needs to be loaded:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(sdcHierarchies)</span></code></pre></div>
<div id="create-and-modify-a-hierarchy-from-scratch" class="section level2">
<h2>Create and modify a hierarchy from scratch</h2>
<p><code>hier_create()</code> allows to create a hierarchy. Argument <code>root</code> specifies the name of the root node. Optionally, it is possible to add some nodes to the top-level by listing their names in argument <code>node_labs</code>. Also, <code>hier_display()</code> shows the hierarchical structure of the current tree as shown below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>h &lt;-<span class="st"> </span><span class="kw">hier_create</span>(<span class="dt">root =</span> <span class="st">&quot;Total&quot;</span>, <span class="dt">nodes =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">hier_display</span>(h)</span></code></pre></div>
<pre><code>## Total
## ├─A
## ├─B
## ├─C
## ├─D
## └─E</code></pre>
<p>Once such an object is created, it can be modified by the following functions:</p>
<ul>
<li><code>hier_add()</code>: allows to add nodes to the hierarchy</li>
<li><code>hier_delete()</code>: allows to delete nodes from the tree</li>
<li><code>hier_rename()</code>: allows to rename nodes</li>
</ul>
<p>These functions can be applied as shown below:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## adding nodes below the node specified in argument `node`</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>h &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h, <span class="dt">root =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;a1&quot;</span>, <span class="st">&quot;a2&quot;</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a>h &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h, <span class="dt">root =</span> <span class="st">&quot;B&quot;</span>, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;b2&quot;</span>))</span>
<span id="cb4-4"><a href="#cb4-4"></a>h &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h, <span class="dt">root =</span> <span class="st">&quot;b1&quot;</span>, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;b1_a&quot;</span>, <span class="st">&quot;b1_b&quot;</span>))</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co"># deleting one or more nodes from the hierarchy</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>h &lt;-<span class="st"> </span><span class="kw">hier_delete</span>(h, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;a1&quot;</span>, <span class="st">&quot;b2&quot;</span>))</span>
<span id="cb4-8"><a href="#cb4-8"></a>h &lt;-<span class="st"> </span><span class="kw">hier_delete</span>(h, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;a2&quot;</span>))</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># rename nodes</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>h &lt;-<span class="st"> </span><span class="kw">hier_rename</span>(h, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;C&quot;</span> =<span class="st"> &quot;X&quot;</span>, <span class="st">&quot;D&quot;</span> =<span class="st"> &quot;Y&quot;</span>))</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="kw">hier_display</span>(h)</span></code></pre></div>
<pre><code>## Total
## ├─A
## ├─B
## │ └─b1
## │   ├─b1_a
## │   └─b1_b
## ├─E
## ├─X
## └─Y</code></pre>
<p>We note that the underlying <a href="https://cran.r-project.org/package=data.tree"><strong>data.tree</strong></a> package allows to modify the objects on reference so no explicit assignment of the form is required.</p>
</div>
<div id="information-about-nodes" class="section level2">
<h2>Information about nodes</h2>
<p>Function <code>hier_info()</code> returns information about the nodes that are specified in argument <code>leaves</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># about a specific node</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>info &lt;-<span class="st"> </span><span class="kw">hier_info</span>(h, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;E&quot;</span>))</span></code></pre></div>
<p><code>info</code> is a named list where each list element refers to a queried node. The results for level <code>b1</code> could be extracted as shown below:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>info<span class="op">$</span>b1</span></code></pre></div>
<pre><code>## $name
## [1] &quot;b1&quot;
## 
## $is_rootnode
## [1] FALSE
## 
## $level
## [1] 3
## 
## $is_leaf
## [1] FALSE
## 
## $siblings
## character(0)
## 
## $contributing_codes
## [1] &quot;b1_a&quot; &quot;b1_b&quot;
## 
## $children
## [1] &quot;b1_a&quot; &quot;b1_b&quot;
## 
## $parent
## [1] &quot;B&quot;
## 
## $is_bogus
## [1] FALSE</code></pre>
<p>Information about all nodes can be extracted by not specifying argument <code>leaves</code>.</p>
</div>
<div id="convert-to-other-formats" class="section level2">
<h2>Convert to other formats</h2>
<p>Function <code>hier_convert()</code> takes a hierarchy and allows to convert the network based structure to different formats while <code>hier_export()</code> does the conversion and writes the results to a file on the disk. The following formats are currently supported:</p>
<ul>
<li><code>df</code>: a “@;label”-based format that can be used in <a href="https://cran.r-project.org/package=sdcTable"><strong>sdcTable</strong></a></li>
<li><code>dt</code>: the same as <code>df</code>, but the result is returned as a </li>
<li><code>argus</code>: also a “@;label”-based format that used to create hrc-files suitable for <a href="https://github.com/sdcTools/tauargus/"><span class="math inline">\(\tau\)</span>-argus</a></li>
<li><code>json</code>: a json-encoded string</li>
<li><code>code</code>: the required code to re-build the current hierarchy</li>
<li><code>sdc</code>: a <code>list</code> which is a suitable input for <a href="https://cran.r-project.org/package=sdcTable"><strong>sdcTable</strong></a></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># conversion to a &quot;@;label&quot;-based format</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>res_df &lt;-<span class="st"> </span><span class="kw">hier_convert</span>(h, <span class="dt">as =</span> <span class="st">&quot;df&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">print</span>(res_df)</span></code></pre></div>
<pre><code>##   level  name
## 1     @ Total
## 2    @@     A
## 3    @@     B
## 4   @@@    b1
## 5  @@@@  b1_a
## 6  @@@@  b1_b
## 7    @@     E
## 8    @@     X
## 9    @@     Y</code></pre>
<p>The required code to create this hierarchy could be computed using:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>code &lt;-<span class="st"> </span><span class="kw">hier_convert</span>(h, <span class="dt">as =</span> <span class="st">&quot;code&quot;</span>); <span class="kw">cat</span>(code, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## library(sdcHierarchies)
## tree &lt;- hier_create(root = &#39;Total&#39;, nodes = c(&#39;A&#39;, &#39;B&#39;, &#39;E&#39;, &#39;X&#39;, &#39;Y&#39;))
## tree &lt;- hier_add(tree = tree, root = &#39;B&#39;, nodes = &#39;b1&#39;)
## tree &lt;- hier_add(tree = tree, root = &#39;b1&#39;, nodes = c(&#39;b1_a&#39;, &#39;b1_b&#39;))
## print(tree)</code></pre>
<p>Using <code>hier_export()</code> one can write the results to a file. This is for example useful if one wants to create <code>hrc</code>-files that could be used as input for <a href="https://github.com/sdcTools/tauargus/"><span class="math inline">\(\tau\)</span>-argus</a> which can be achieved as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">hier_export</span>(h, <span class="dt">as =</span> <span class="st">&quot;argus&quot;</span>, <span class="dt">path =</span> <span class="kw">file.path</span>(<span class="kw">tempfile</span>(), <span class="st">&quot;hierarchy.hrc&quot;</span>))</span></code></pre></div>
</div>
<div id="create-a-hierarchy-from-data.frames-code-or-json" class="section level2">
<h2>Create a hierarchy from data.frames, code or json</h2>
<p><code>hier_import()</code> returns a network-based hierarchy given either a data.frame (in <code>@;labs</code>-format), json format, code or from a tau-argus compatible <code>hrc-file</code>. For example if we want to create a hierarchy based of <code>res_df</code> which was previously created using <code>hier_convert()</code>, the code is as simple as:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>n_df &lt;-<span class="st"> </span><span class="kw">hier_import</span>(<span class="dt">inp =</span> res_df, <span class="dt">from =</span> <span class="st">&quot;df&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">hier_display</span>(n_df)</span></code></pre></div>
<pre><code>## Total
## ├─A
## ├─B
## │ └─b1
## │   ├─b1_a
## │   └─b1_b
## ├─E
## ├─X
## └─Y</code></pre>
<p>Using <code>hier_import(inp = &quot;hierarchy.hrc&quot;, from = &quot;argus&quot;)</code> one could create a sdc hierarchy object directly from a <code>hrc</code>-file.</p>
</div>
<div id="createcompute-hierarchies-from-a-string" class="section level2">
<h2>Create/Compute hierarchies from a string</h2>
<p>Often it is the case, the the nested hierarchy information in encoded in a string. Function <code>hier_compute()</code> allows to transform such strings into hierarchy objects. One can distinguish two cases: The first case is where all input codes have the same length while in the latter case the length of the codes differs. Let’s assume we have a geographic code given in <code>geo_m</code> where digits 1-2 refer to the first level, digit 3 to the second and digits 4-5 to the third level of the hierarchy.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>geo_m &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="st">&quot;01051&quot;</span>, <span class="st">&quot;01053&quot;</span>, <span class="st">&quot;01054&quot;</span>, <span class="st">&quot;01055&quot;</span>, <span class="st">&quot;01056&quot;</span>, <span class="st">&quot;01057&quot;</span>, <span class="st">&quot;01058&quot;</span>, <span class="st">&quot;01059&quot;</span>, <span class="st">&quot;01060&quot;</span>, <span class="st">&quot;01061&quot;</span>, <span class="st">&quot;01062&quot;</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="st">&quot;02000&quot;</span>,</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="st">&quot;03151&quot;</span>, <span class="st">&quot;03152&quot;</span>, <span class="st">&quot;03153&quot;</span>, <span class="st">&quot;03154&quot;</span>, <span class="st">&quot;03155&quot;</span>, <span class="st">&quot;03156&quot;</span>, <span class="st">&quot;03157&quot;</span>, <span class="st">&quot;03158&quot;</span>, <span class="st">&quot;03251&quot;</span>, <span class="st">&quot;03252&quot;</span>, <span class="st">&quot;03254&quot;</span>, <span class="st">&quot;03255&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="st">&quot;03256&quot;</span>, <span class="st">&quot;03257&quot;</span>, <span class="st">&quot;03351&quot;</span>, <span class="st">&quot;03352&quot;</span>, <span class="st">&quot;03353&quot;</span>, <span class="st">&quot;03354&quot;</span>, <span class="st">&quot;03355&quot;</span>, <span class="st">&quot;03356&quot;</span>, <span class="st">&quot;03357&quot;</span>, <span class="st">&quot;03358&quot;</span>, <span class="st">&quot;03359&quot;</span>, <span class="st">&quot;03360&quot;</span>,</span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="st">&quot;03361&quot;</span>, <span class="st">&quot;03451&quot;</span>, <span class="st">&quot;03452&quot;</span>, <span class="st">&quot;03453&quot;</span>, <span class="st">&quot;03454&quot;</span>, <span class="st">&quot;03455&quot;</span>, <span class="st">&quot;03456&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="st">&quot;10155&quot;</span>)</span></code></pre></div>
<p>Function <code>hier_compute()</code> takes a character vector and creates a hierarchy from it. In argument <code>method</code>, two ways of specifying the encoded levels can be chosen.</p>
<ul>
<li><code>endpos</code>: an integerish-vector must be specified in argument <code>dim_spec</code> holding the end-position at each level</li>
<li><code>len</code>: an integerish-vector must be specified in argument <code>dim_spec</code> containing for each level how many digits are required</li>
</ul>
<p>In case the overal total is not encoded in the input, specifying argument <code>root</code> allows to give a name to the overall total. Additionally, it is possible to set the desired output format in parameter <code>as</code>. In the example below setting <code>as = &quot;df&quot;</code> returns the result as a <code>data.frame</code> in <code>@; key</code>-format. The two methods on how to define the positions of the levels are interchangable and lead to the same hierarchy as shown below:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>v1 &lt;-<span class="st"> </span><span class="kw">hier_compute</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="dt">inp =</span> geo_m, </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="dt">dim_spec =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>), </span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="dt">root =</span> <span class="st">&quot;Tot&quot;</span>, </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="dt">method =</span> <span class="st">&quot;endpos&quot;</span>, </span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="dt">as =</span> <span class="st">&quot;df&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>)</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a>v2 &lt;-<span class="st"> </span><span class="kw">hier_compute</span>(</span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="dt">inp =</span> geo_m, </span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="dt">dim_spec =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="dt">root =</span> <span class="st">&quot;Tot&quot;</span>, </span>
<span id="cb17-13"><a href="#cb17-13"></a>  <span class="dt">method =</span> <span class="st">&quot;len&quot;</span>,</span>
<span id="cb17-14"><a href="#cb17-14"></a>  <span class="dt">as =</span> <span class="st">&quot;df&quot;</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>)</span>
<span id="cb17-16"><a href="#cb17-16"></a></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="kw">identical</span>(v1, v2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">hier_display</span>(v1)</span></code></pre></div>
<pre><code>## Tot
## ├─01
## │ └─010
## │   ├─01051
## │   ├─01053
## │   ├─01054
## │   ├─01055
## │   ├─01056
## │   ├─01057
## │   ├─01058
## │   ├─01059
## │   ├─01060
## │   ├─01061
## │   └─01062
## ├─02
## │ └─020
## │   └─02000
## ├─03
## │ ├─031
## │ │ ├─03151
## │ │ ├─03152
## │ │ ├─03153
## │ │ ├─03154
## │ │ ├─03155
## │ │ ├─03156
## │ │ ├─03157
## │ │ └─03158
## │ ├─032
## │ │ ├─03251
## │ │ ├─03252
## │ │ ├─03254
## │ │ ├─03255
## │ │ ├─03256
## │ │ └─03257
## │ ├─033
## │ │ ├─03351
## │ │ ├─03352
## │ │ ├─03353
## │ │ ├─03354
## │ │ ├─03355
## │ │ ├─03356
## │ │ ├─03357
## │ │ ├─03358
## │ │ ├─03359
## │ │ ├─03360
## │ │ └─03361
## │ └─034
## │   ├─03451
## │   ├─03452
## │   ├─03453
## │   ├─03454
## │   ├─03455
## │   └─03456
## └─10
##   └─101
##     └─10155</code></pre>
<p>If the total is contained in the string, let’s say in the first 3 positions of the input values, the hierarchy can be computed as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>geo_m_with_tot &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Tot&quot;</span>, geo_m)</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">head</span>(geo_m_with_tot)</span></code></pre></div>
<pre><code>## [1] &quot;Tot01051&quot; &quot;Tot01053&quot; &quot;Tot01054&quot; &quot;Tot01055&quot; &quot;Tot01056&quot; &quot;Tot01057&quot;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>v3 &lt;-<span class="st"> </span><span class="kw">hier_compute</span>(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="dt">inp =</span> geo_m_with_tot, </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="dt">dim_spec =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="dt">method =</span> <span class="st">&quot;len&quot;</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>); <span class="kw">hier_display</span>(v3)</span></code></pre></div>
<pre><code>## Tot
## ├─01
## │ └─010
## │   ├─01051
## │   ├─01053
## │   ├─01054
## │   ├─01055
## │   ├─01056
## │   ├─01057
## │   ├─01058
## │   ├─01059
## │   ├─01060
## │   ├─01061
## │   └─01062
## ├─02
## │ └─020
## │   └─02000
## ├─03
## │ ├─031
## │ │ ├─03151
## │ │ ├─03152
## │ │ ├─03153
## │ │ ├─03154
## │ │ ├─03155
## │ │ ├─03156
## │ │ ├─03157
## │ │ └─03158
## │ ├─032
## │ │ ├─03251
## │ │ ├─03252
## │ │ ├─03254
## │ │ ├─03255
## │ │ ├─03256
## │ │ └─03257
## │ ├─033
## │ │ ├─03351
## │ │ ├─03352
## │ │ ├─03353
## │ │ ├─03354
## │ │ ├─03355
## │ │ ├─03356
## │ │ ├─03357
## │ │ ├─03358
## │ │ ├─03359
## │ │ ├─03360
## │ │ └─03361
## │ └─034
## │   ├─03451
## │   ├─03452
## │   ├─03453
## │   ├─03454
## │   ├─03455
## │   └─03456
## └─10
##   └─101
##     └─10155</code></pre>
<p>The result is the same as <code>v1</code> and <code>v2</code> previously generated.</p>
<p><code>hier_compute()</code> can also deal with inputs that are of different length as shown in the next example.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">## second example, unequal strings; overall total not included in input</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>yae_h &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="st">&quot;1.1.1.&quot;</span>, <span class="st">&quot;1.1.2.&quot;</span>,</span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="st">&quot;1.2.1.&quot;</span>, <span class="st">&quot;1.2.2.&quot;</span>, <span class="st">&quot;1.2.3.&quot;</span>, <span class="st">&quot;1.2.4.&quot;</span>, <span class="st">&quot;1.2.5.&quot;</span>, <span class="st">&quot;1.3.1.&quot;</span>,</span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="st">&quot;1.3.2.&quot;</span>, <span class="st">&quot;1.3.3.&quot;</span>, <span class="st">&quot;1.3.4.&quot;</span>, <span class="st">&quot;1.3.5.&quot;</span>,</span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="st">&quot;1.4.1.&quot;</span>, <span class="st">&quot;1.4.2.&quot;</span>, <span class="st">&quot;1.4.3.&quot;</span>, <span class="st">&quot;1.4.4.&quot;</span>, <span class="st">&quot;1.4.5.&quot;</span>,</span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="st">&quot;1.5.&quot;</span>, <span class="st">&quot;1.6.&quot;</span>, <span class="st">&quot;1.7.&quot;</span>, <span class="st">&quot;1.8.&quot;</span>, <span class="st">&quot;1.9.&quot;</span>, <span class="st">&quot;2.&quot;</span>, <span class="st">&quot;3.&quot;</span>)</span>
<span id="cb25-8"><a href="#cb25-8"></a>v1 &lt;-<span class="st"> </span><span class="kw">hier_compute</span>(</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="dt">inp =</span> yae_h, </span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="dt">dim_spec =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>), </span>
<span id="cb25-11"><a href="#cb25-11"></a>  <span class="dt">root =</span> <span class="st">&quot;Tot&quot;</span>, </span>
<span id="cb25-12"><a href="#cb25-12"></a>  <span class="dt">method =</span> <span class="st">&quot;len&quot;</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>); <span class="kw">hier_display</span>(v1)</span></code></pre></div>
<pre><code>## Tot
## ├─1.
## │ ├─1.1.
## │ │ ├─1.1.1.
## │ │ └─1.1.2.
## │ ├─1.2.
## │ │ ├─1.2.1.
## │ │ ├─1.2.2.
## │ │ ├─1.2.3.
## │ │ ├─1.2.4.
## │ │ └─1.2.5.
## │ ├─1.3.
## │ │ ├─1.3.1.
## │ │ ├─1.3.2.
## │ │ ├─1.3.3.
## │ │ ├─1.3.4.
## │ │ └─1.3.5.
## │ ├─1.4.
## │ │ ├─1.4.1.
## │ │ ├─1.4.2.
## │ │ ├─1.4.3.
## │ │ ├─1.4.4.
## │ │ └─1.4.5.
## │ ├─1.5.
## │ ├─1.6.
## │ ├─1.7.
## │ ├─1.8.
## │ └─1.9.
## ├─2.
## └─3.</code></pre>
<p>We also note that there is another way to specify the inputs in <code>hier_compute()</code>. Setting argument <code>method = &quot;list&quot;</code> allows to create a hierarchy from a given named list. In such a list, the name of a list element is interpreted as the name of the parent node of all codes of the specific list element. An example is shown below:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>yae_ll &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb27-2"><a href="#cb27-2"></a>yae_ll[[<span class="st">&quot;Total&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1.&quot;</span>, <span class="st">&quot;2.&quot;</span>, <span class="st">&quot;3.&quot;</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a>yae_ll[[<span class="st">&quot;1.&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;1.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="st">&quot;.&quot;</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a>yae_ll[[<span class="st">&quot;1.1.&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;1.1.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="st">&quot;.&quot;</span>)</span>
<span id="cb27-5"><a href="#cb27-5"></a>yae_ll[[<span class="st">&quot;1.2.&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;1.2.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="st">&quot;.&quot;</span>)</span>
<span id="cb27-6"><a href="#cb27-6"></a>yae_ll[[<span class="st">&quot;1.3.&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;1.3.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="st">&quot;.&quot;</span>)</span>
<span id="cb27-7"><a href="#cb27-7"></a>yae_ll[[<span class="st">&quot;1.4.&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;1.4.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="st">&quot;.&quot;</span>)</span>
<span id="cb27-8"><a href="#cb27-8"></a>d &lt;-<span class="st"> </span><span class="kw">hier_compute</span>(<span class="dt">inp =</span> yae_ll, <span class="dt">root =</span> <span class="st">&quot;Total&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;list&quot;</span>) </span></code></pre></div>
<pre><code>## Argument &#39;dim_spec&#39; is ignored when constructing a hierarchy from a nested list.</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">hier_display</span>(d)</span></code></pre></div>
<pre><code>## Total
## ├─1.
## │ ├─1.1.
## │ │ ├─1.1.1.
## │ │ └─1.1.2.
## │ ├─1.2.
## │ │ ├─1.2.1.
## │ │ ├─1.2.2.
## │ │ ├─1.2.3.
## │ │ ├─1.2.4.
## │ │ └─1.2.5.
## │ ├─1.3.
## │ │ ├─1.3.1.
## │ │ ├─1.3.2.
## │ │ ├─1.3.3.
## │ │ ├─1.3.4.
## │ │ └─1.3.5.
## │ ├─1.4.
## │ │ ├─1.4.1.
## │ │ ├─1.4.2.
## │ │ ├─1.4.3.
## │ │ ├─1.4.4.
## │ │ ├─1.4.5.
## │ │ └─1.4.6.
## │ ├─1.5.
## │ ├─1.6.
## │ ├─1.7.
## │ ├─1.8.
## │ └─1.9.
## ├─2.
## └─3.</code></pre>
</div>
<div id="grids" class="section level2">
<h2>Grids</h2>
<p>Using <code>hier_grid()</code> it is possible to compute all combinations of codes given several hierarchies. This is useful to build a complete table (e.g for merging purposes). The functionality of <code>hier_grid</code> is shown below. First, we need to specify some hierarchies.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>h1 &lt;-<span class="st"> </span><span class="kw">hier_create</span>(<span class="st">&quot;Total&quot;</span>, <span class="dt">nodes =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb31-2"><a href="#cb31-2"></a>h1 &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h1, <span class="dt">root =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">node =</span> <span class="st">&quot;a1&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a>h1 &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h1, <span class="dt">root =</span> <span class="st">&quot;a1&quot;</span>, <span class="dt">node =</span> <span class="st">&quot;aa1&quot;</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a>h2 &lt;-<span class="st"> </span><span class="kw">hier_create</span>(<span class="st">&quot;Total&quot;</span>, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span>
<span id="cb31-6"><a href="#cb31-6"></a>h2 &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h2, <span class="dt">root =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">node =</span> <span class="st">&quot;b1&quot;</span>)</span>
<span id="cb31-7"><a href="#cb31-7"></a>h2 &lt;-<span class="st"> </span><span class="kw">hier_add</span>(h2, <span class="dt">root =</span> <span class="st">&quot;d&quot;</span>, <span class="dt">node =</span> <span class="st">&quot;d1&quot;</span>)</span></code></pre></div>
<p>Note that we - on purpose - added some <em>“bogus”</em> codes to each <code>h1</code> and <code>h2</code> as codes <code>a1</code> and <code>aa1</code> in <code>h1</code> and <code>b1</code> and <code>d1</code> in <code>h2</code> are just identical to their respective parent categories. Applying <code>hier_grid</code> is as simple as</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">hier_grid</span>(h1, h2)</span></code></pre></div>
<pre><code>##        v1    v2
##  1: Total Total
##  2:     A Total
##  3:     B Total
##  4:     C Total
##  5:    a1 Total
##  6:   aa1 Total
##  7: Total     a
##  8:     A     a
##  9:     B     a
## 10:     C     a
## 11:    a1     a
## 12:   aa1     a
## 13: Total     b
## 14:     A     b
## 15:     B     b
## 16:     C     b
## 17:    a1     b
## 18:   aa1     b
## 19: Total     c
## 20:     A     c
## 21:     B     c
## 22:     C     c
## 23:    a1     c
## 24:   aa1     c
## 25: Total     d
## 26:     A     d
## 27:     B     d
## 28:     C     d
## 29:    a1     d
## 30:   aa1     d
## 31: Total     e
## 32:     A     e
## 33:     B     e
## 34:     C     e
## 35:    a1     e
## 36:   aa1     e
## 37: Total    b1
## 38:     A    b1
## 39:     B    b1
## 40:     C    b1
## 41:    a1    b1
## 42:   aa1    b1
## 43: Total    d1
## 44:     A    d1
## 45:     B    d1
## 46:     C    d1
## 47:    a1    d1
## 48:   aa1    d1
##        v1    v2</code></pre>
<p>separating all target hierarchies with a <code>,</code>. <code>hier_grid</code> then computes all combinations of codes from hierarchies <code>h1</code> and <code>h2</code>. Using the default options, these bogus codes are included in the output <code>data.table</code>. Setting argument <code>add_dups = FALSE</code> removes all rows containing such bogus codes. Setting option <code>add_levs = TRUE</code> adds some columns labeled <code>levs_v{n}</code> to the output data set. Each of this colum contains values which define the hierarchy level of the corresponding code given in variable v{n} in the same row in the table as shown below.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">hier_grid</span>(h1, h2, <span class="dt">add_dups =</span> <span class="ot">FALSE</span>, <span class="dt">add_levs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        v1    v2 levs_v1 levs_v2
##  1: Total Total       1       1
##  2:     A Total       2       1
##  3:     B Total       2       1
##  4:     C Total       2       1
##  5: Total     a       1       2
##  6:     A     a       2       2
##  7:     B     a       2       2
##  8:     C     a       2       2
##  9: Total     b       1       2
## 10:     A     b       2       2
## 11:     B     b       2       2
## 12:     C     b       2       2
## 13: Total     c       1       2
## 14:     A     c       2       2
## 15:     B     c       2       2
## 16:     C     c       2       2
## 17: Total     d       1       2
## 18:     A     d       2       2
## 19:     B     d       2       2
## 20:     C     d       2       2
## 21: Total     e       1       2
## 22:     A     e       2       2
## 23:     B     e       2       2
## 24:     C     e       2       2
##        v1    v2 levs_v1 levs_v2</code></pre>
</div>
<div id="interactively-create-or-modify-hierarchies" class="section level2">
<h2>Interactively create or modify hierarchies</h2>
<p>The package also contains a shiny-based interactive app that can be started using <code>hier_app()</code>. The app allows to pass as input either a character vector (that should be converted into a hierarchy) or an existing hierarchy and can be started as follows given the hierarchy previously generated using <code>hier_compute()</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>d &lt;-<span class="st"> </span><span class="kw">hier_app</span>(d)</span></code></pre></div>
<p>If a character vector is passed to <code>hier_app()</code>, the interface allows to specify the arguments for <code>hier_compute()</code>. Once a hierarchy is created, the interface changes and the tree can be dynamically changed by dragging nodes around. Futhermore, it is possible to add, remove or rename nodes. The required code to construct the current hierarchy is displayed and can be saved to disk. Furthermore, there is functionality to <em>undo</em> the last step as well as to export results to either the <strong>R</strong>-session or write results to a file. This is especially helpful if one wants to create for example an <code>hrc</code>-file as input for <span class="math inline">\(\tau\)</span>-argus. Please note that <code>hier_app()</code> is able to return the modified hierarchy and not only save results to disk. In order to continue working, one may assign the result to a new object as shown in the code above.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>In case you have any suggestions or improvements, please feel free to file an issue at <a href="https://github.com/bernhard-da/sdcHierarchies/issues"><strong>our issue tracker</strong></a> or contribute to the package by filing a <a href="https://github.com/bernhard-da/sdcHierarchies/pulls"><strong>pull request</strong></a> against the master branch.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
